<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filtered Network Performance Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Filter Network Performance Data</h1>

    <!-- Filter Form -->
    <form method="get" action="{% url 'network_data_filtered' %}" id="filterForm">
        {% csrf_token %}
        <label for="africa_region">Africa Region:</label>
        <select name="africa_region" id="africa_region" onchange="document.getElementById('filterForm').submit();">
            <option value="" {% if not request.GET.africa_region %}selected{% endif %}>All Regions</option>
            {% for region in africa_regions %}
                <option value="{{ region.africa_region_name }}" {% if request.GET.africa_region == region.africa_region_name %}selected{% endif %}>
                    {{ region.africa_region_name }}
                </option>
            {% endfor %}
        </select>
    </form>

   <!-- Display Charts -->
   <h2>Filtered Network Performance Data</h2>
   {% if chart_data %}
       <!-- Bar Chart -->
       <h3>Bar Chart: Download and Upload Speeds</h3>
       <canvas id="barChart"></canvas>

       <!-- Pie Chart -->
       <h3>Pie Chart: Average Latency</h3>
       <canvas id="pieChart"></canvas>

       <script>
           document.addEventListener('DOMContentLoaded', function() {
               const chartData = JSON.parse('{{ chart_data|escapejs }}');

               // Bar Chart
               const barCtx = document.getElementById('barChart').getContext('2d');
               new Chart(barCtx, {
                   type: 'bar',
                   data: chartData.bar_chart,
                   options: {
                       responsive: true,
                       plugins: {
                           legend: {
                               position: 'top',
                           },
                           tooltip: {
                               callbacks: {
                                   label: function(tooltipItem) {
                                       return tooltipItem.dataset.label + ': ' + tooltipItem.raw + ' Mbps';
                                   }
                               }
                           }
                       },
                       scales: {
                           x: {
                               title: {
                                   display: true,
                                   text: 'Country'
                               }
                           },
                           y: {
                               title: {
                                   display: true,
                                   text: 'Metrics (Mbps)'
                               }
                           }
                       }
                   }
               });

               // Pie Chart
               const pieCtx = document.getElementById('pieChart').getContext('2d');
               new Chart(pieCtx, {
                   type: 'pie',
                   data: chartData.pie_chart,
                   options: {
                       responsive: true,
                       plugins: {
                           legend: {
                               position: 'top',
                           },
                           tooltip: {
                               callbacks: {
                                   label: function(tooltipItem) {
                                       return tooltipItem.label + ': ' + tooltipItem.raw + ' ms';
                                   }
                               }
                           }
                       }
                   }
               });
           });
       </script>
   {% else %}
       <p>No data available for the selected region.</p>
   {% endif %}
</body>
</html>
